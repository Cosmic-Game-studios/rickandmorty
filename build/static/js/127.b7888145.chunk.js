"use strict";(self.webpackChunkrick_and_morty_adventure=self.webpackChunkrick_and_morty_adventure||[]).push([[127],{5127:(e,t,s)=>{s.r(t),s.d(t,{default:()=>M});var r=s(9379),n=s(5043),a=s(5475),l=s(2678),i=s(9806),o=s(3089),c=s(3969),d=s(4842),u=s(2097),h=s(172),x=s(6803),m=s(6995),A=s(267),j=s(8973),p=s(2156),v=s(6592),b=s(9067),f=s(2579),g=s(7780),y=s(847),k=s(8315),C=s(1863),w=s(579);const S=n.lazy((()=>s.e(992).then(s.bind(s,1992)))),L=e=>{let{message:t,small:s}=e;return(0,w.jsxs)(c.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",p:s?1:3,my:2},role:"status","aria-live":"polite",children:[(0,w.jsx)(h.A,{size:s?24:40,sx:{mb:t?1:0}}),t&&(0,w.jsx)(d.A,{variant:s?"body2":"subtitle1",color:"text.secondary",children:t})]})},R=e=>{let{message:t,onRetry:s}=e;return(0,w.jsx)(x.A,{severity:"error",action:s?(0,w.jsx)(u.A,{color:"inherit",size:"small",onClick:s,children:"Try Again"}):null,sx:{my:2},children:t})},E=()=>(0,w.jsxs)(c.A,{sx:{textAlign:"center",p:3,my:2},children:[(0,w.jsx)(d.A,{variant:"h6",gutterBottom:!0,children:"No Characters Found"}),(0,w.jsx)(d.A,{color:"text.secondary",children:"There are no characters available that match your criteria."})]}),z=e=>{let{onFilterChange:t,filterActive:s,onClearFilter:r}=e;const[a,l]=(0,n.useState)(null),i=Boolean(a),[o,h]=(0,n.useState)(""),[x,m]=(0,n.useState)(""),A=()=>{l(null)};return(0,w.jsxs)(c.A,{children:[(0,w.jsx)(f.A,{"aria-label":"filter characters","aria-controls":"filter-menu","aria-haspopup":"true",onClick:e=>{l(e.currentTarget)},color:"inherit",children:(0,w.jsx)(C.A,{color:"secondary",variant:"dot",invisible:!s,children:(0,w.jsx)(y.A,{})})}),(0,w.jsxs)(g.A,{id:"filter-menu",anchorEl:a,open:i,onClose:A,MenuListProps:{"aria-labelledby":"filter-button"},PaperProps:{sx:{width:"280px",p:2}},children:[(0,w.jsx)(d.A,{variant:"h6",sx:{mb:1},children:"Filter By"}),(0,w.jsxs)(v.A,{fullWidth:!0,sx:{mb:2},children:[(0,w.jsx)(b.A,{id:"status-filter-label",children:"Status"}),(0,w.jsxs)(j.A,{labelId:"status-filter-label",id:"status-filter",value:o,label:"Status",onChange:e=>h(e.target.value),children:[(0,w.jsx)(p.A,{value:"",children:"Any"}),(0,w.jsx)(p.A,{value:"alive",children:"Alive"}),(0,w.jsx)(p.A,{value:"dead",children:"Dead"}),(0,w.jsx)(p.A,{value:"unknown",children:"Unknown"})]})]}),(0,w.jsxs)(v.A,{fullWidth:!0,sx:{mb:2},children:[(0,w.jsx)(b.A,{id:"species-filter-label",children:"Species"}),(0,w.jsxs)(j.A,{labelId:"species-filter-label",id:"species-filter",value:x,label:"Species",onChange:e=>m(e.target.value),children:[(0,w.jsx)(p.A,{value:"",children:"Any"}),(0,w.jsx)(p.A,{value:"Human",children:"Human"}),(0,w.jsx)(p.A,{value:"Alien",children:"Alien"}),(0,w.jsx)(p.A,{value:"Robot",children:"Robot"}),(0,w.jsx)(p.A,{value:"Humanoid",children:"Humanoid"})]})]}),(0,w.jsxs)(c.A,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,w.jsx)(u.A,{onClick:()=>{h(""),m(""),r(),A()},color:"secondary",children:"Clear All"}),(0,w.jsx)(u.A,{onClick:()=>{t({status:o,species:x}),A()},variant:"contained",children:"Apply"})]})]})]})};function I(){const e=(0,A.A)(),t=(0,m.A)(e.breakpoints.down("sm")),{unlockedCharacters:s=[]}=(0,n.useContext)(l.Rs)||{},[x,g]=(0,n.useState)([]),[y,C]=(0,n.useState)(1),[I,M]=(0,n.useState)(!0),[F,T]=(0,n.useState)(!1),[_,H]=(0,n.useState)(!0),[B,D]=(0,n.useState)(""),q=(0,n.useRef)(null),[N,P]=(0,n.useState)({}),[W,O]=(0,n.useState)(!1),Y=(0,n.useRef)(0),[U,X]=(0,n.useState)(!1),G=(0,n.useRef)(0),J=(0,n.useRef)(null),K=(0,n.useCallback)((e=>{let t="https://rickandmortyapi.com/api/character?page=".concat(e);const s=new URLSearchParams;N.status&&s.append("status",N.status),N.species&&s.append("species",N.species);const r=s.toString();return r&&(t+="&".concat(r)),t}),[N]),Q=(0,n.useCallback)((async function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];s||n?(H(!0),n&&(g([]),C(1),e=1)):T(!0),D(""),n||s||(Y.current=window.scrollY);try{const a=await fetch(K(e),{signal:AbortSignal.timeout(t?7e3:1e4)});if(!a.ok)throw new Error(404===a.status?"No characters found for these filters.":"Error loading characters (".concat(a.status,")"));const l=await a.json();g((t=>{if(n||s&&Object.keys(N).length>0&&1===e)return l.results.map(((e,t)=>(0,r.A)((0,r.A)({},e),{},{requiredLevel:e.requiredLevel||Math.max(1,t+1)})));const a=new Set(t.map((e=>e.id))),i=l.results.filter((e=>!a.has(e.id)));return[...t,...i.map(((e,s)=>(0,r.A)((0,r.A)({},e),{},{requiredLevel:e.requiredLevel||Math.max(1,t.length+s+1)})))]})),M(Boolean(l.info&&l.info.next))}catch(a){"AbortError"===a.name?D("Request timed out. Please check your connection."):D(a.message||"Failed to load characters."),console.error("Error loading characters:",a)}finally{s||n?(H(!1),n&&t&&window.scrollTo({top:0,behavior:"smooth"})):(T(!1),t&&!n&&setTimeout((()=>window.scrollTo({top:Y.current})),100)),X(!1)}}),[K,N,t]);(0,n.useEffect)((()=>{1===y&&Q(1,!0,Object.keys(N).length>0||x.length>0)}),[N,Q]);const V=(0,n.useCallback)((()=>{!I||F||_||C((e=>{const t=e+1;return Q(t,!1,!1),t}))}),[I,F,_,Q]),Z=(0,n.useCallback)((()=>{Q(y,1===y)}),[Q,y]),$=(0,n.useCallback)((e=>{P(e),O(Object.values(e).some(Boolean)),C(1)}),[]),ee=(0,n.useCallback)((()=>{P({}),O(!1),C(1)}),[]);(0,n.useEffect)((()=>{if(F||_||!I||!q.current)return;let e;const s=new IntersectionObserver((t=>{t[0].isIntersecting&&(clearTimeout(e),e=setTimeout(V,300))}),{threshold:t?.1:.5,rootMargin:t?"50px":"200px"}),r=q.current;return s.observe(r),()=>{clearTimeout(e),r&&s.unobserve(r)}}),[F,_,I,V,t]),(0,n.useEffect)((()=>{if(!t||!J.current)return;const e=J.current,s=e=>{G.current=e.touches[0].clientY},r=e=>{if(window.scrollY>5)return;e.touches[0].clientY-G.current>70&&!U&&X(!0)},n=()=>{U&&Q(1,!0,!0)};return e.addEventListener("touchstart",s,{passive:!0}),e.addEventListener("touchmove",r,{passive:!0}),e.addEventListener("touchend",n),()=>{e.removeEventListener("touchstart",s),e.removeEventListener("touchmove",r),e.removeEventListener("touchend",n)}}),[t,U,Q]);const te=(0,n.useMemo)((()=>x.filter((e=>e&&e.id)).map((e=>{const r=s.some((t=>t&&t.id===e.id)),a=(0,w.jsx)(o.A,{item:!0,xs:6,sm:4,md:3,children:(0,w.jsxs)(c.A,{sx:{aspectRatio:"1 / 1.5",backgroundColor:"grey.200",borderRadius:1,display:"flex",flexDirection:"column",justifyContent:"flex-end",p:1},children:[(0,w.jsx)(c.A,{sx:{height:"60%",backgroundColor:"grey.300",mb:1,borderRadius:.5}}),(0,w.jsx)(c.A,{sx:{height:"10%",backgroundColor:"grey.300",width:"80%",borderRadius:.5}})]})},"skeleton-".concat(e.id||Math.random()));return(0,w.jsx)(o.A,{item:!0,xs:6,sm:4,md:3,children:(0,w.jsx)(n.Suspense,{fallback:a,children:(0,w.jsx)(S,{character:e,unlocked:r,isMobile:t})})},"character-".concat(e.id))}))),[x,s,t]);return(0,w.jsxs)(i.A,{ref:J,maxWidth:"lg",sx:{py:2},children:[U&&(0,w.jsxs)(c.A,{sx:{position:"fixed",top:10,left:"50%",transform:"translateX(-50%)",zIndex:2e3,display:"flex",alignItems:"center",bgcolor:"background.paper",p:1,borderRadius:1,boxShadow:3},children:[(0,w.jsx)(h.A,{size:20,sx:{mr:1}}),(0,w.jsx)(d.A,{variant:"caption",children:"Release to refresh"})]}),(0,w.jsxs)(c.A,{component:"header",sx:{display:"flex",flexDirection:t?"column":"row",justifyContent:"space-between",alignItems:"center",mb:2,p:t?1:2,bgcolor:"background.paper",borderRadius:1,boxShadow:1},children:[(0,w.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",width:t?"100%":"auto",justifyContent:t?"space-between":"flex-start"},children:[t&&(0,w.jsx)(f.A,{component:a.N_,to:"/","aria-label":"back to home",size:"small",children:(0,w.jsx)(k.A,{})}),(0,w.jsx)(d.A,{variant:t?"h5":"h4",component:"h1",sx:{flexGrow:t?1:0,textAlign:t?"center":"left"},children:"Characters"}),t&&(0,w.jsx)(z,{onFilterChange:$,filterActive:W,onClearFilter:ee})]}),!t&&(0,w.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,w.jsxs)(v.A,{size:"small",sx:{minWidth:120},children:[(0,w.jsx)(b.A,{children:"Status"}),(0,w.jsxs)(j.A,{value:N.status||"",label:"Status",onChange:e=>$((0,r.A)((0,r.A)({},N),{},{status:e.target.value})),children:[(0,w.jsx)(p.A,{value:"",children:"Any"}),(0,w.jsx)(p.A,{value:"alive",children:"Alive"}),(0,w.jsx)(p.A,{value:"dead",children:"Dead"}),(0,w.jsx)(p.A,{value:"unknown",children:"Unknown"})]})]}),(0,w.jsxs)(v.A,{size:"small",sx:{minWidth:120},children:[(0,w.jsx)(b.A,{children:"Species"}),(0,w.jsxs)(j.A,{value:N.species||"",label:"Species",onChange:e=>$((0,r.A)((0,r.A)({},N),{},{species:e.target.value})),children:[(0,w.jsx)(p.A,{value:"",children:"Any"}),(0,w.jsx)(p.A,{value:"Human",children:"Human"}),(0,w.jsx)(p.A,{value:"Alien",children:"Alien"})," "]})]}),W&&(0,w.jsx)(u.A,{onClick:ee,size:"small",children:"Clear Filters"}),(0,w.jsx)(u.A,{component:a.N_,to:"/",variant:"outlined",size:"small",children:"Back to Home"})]}),!t&&(0,w.jsx)(d.A,{variant:"subtitle1",color:"text.secondary",sx:{width:"100%",mt:1,textAlign:"left"},children:"Discover and unlock characters from across the multiverse."})]}),(0,w.jsxs)(c.A,{component:"main","aria-busy":_||F,children:[B&&(0,w.jsx)(R,{message:B,onRetry:Z}),_&&!B?(0,w.jsx)(L,{message:t?"Loading characters...":"Loading characters from the multiverse..."}):0!==x.length||F||B?(0,w.jsxs)(n.Fragment,{children:[(0,w.jsxs)(c.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:1,mb:1,bgcolor:"grey.100",borderRadius:1},children:[(0,w.jsxs)(d.A,{variant:"body2",color:"text.secondary",children:["Showing ",x.length," characters"]}),s.length>0&&(0,w.jsxs)(d.A,{variant:"body2",color:"text.secondary",children:[s.length," unlocked"]})]}),(0,w.jsx)(o.A,{container:!0,spacing:t?1.5:2,children:te}),F&&!_&&(0,w.jsx)(L,{message:t?"Loading...":"Loading more characters...",small:!0})]}):(0,w.jsx)(E,{}),I&&!_&&!B&&(0,w.jsx)("div",{ref:q,style:{height:"20px",margin:"10px 0"}})]}),t?(0,w.jsx)(c.A,{sx:{position:"fixed",bottom:16,left:"50%",transform:"translateX(-50%)",zIndex:1e3,visibility:F||!I||_?"hidden":"visible"},children:(0,w.jsx)(u.A,{onClick:V,disabled:!I||F||_,variant:"contained",size:"medium",children:F?"Loading...":I?"Load More":"No More"})}):(0,w.jsx)(c.A,{component:"footer",sx:{textAlign:"center",py:2,mt:2,visibility:F||!I||_?"hidden":"visible"},children:(0,w.jsx)(u.A,{onClick:V,disabled:!I||F||_,variant:"contained",size:"large",children:F?"Loading...":I?"Load More Characters":"End of Results"})})]})}const M=n.memo(I)}}]);
//# sourceMappingURL=127.b7888145.chunk.js.map